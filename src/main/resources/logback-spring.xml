<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE configuration>

<configuration>
    <include resource="org/springframework/boot/logging/logback/defaults.xml"/>
    <include resource="org/springframework/boot/logging/logback/console-appender.xml"/>
    <import class="ch.qos.logback.core.FileAppender"/>
    <import class="ch.qos.logback.classic.encoder.PatternLayoutEncoder"/>
    <import class="ch.qos.logback.classic.html.HTMLLayout"/>
    <import class="ch.qos.logback.classic.net.SMTPAppender"/>
    <import class="ch.qos.logback.core.spi.CyclicBufferTracker"/>
    <appender name="SECURITY_EVENTS_FILE_APPENDER" class="FileAppender">
        <file>logs/security.log</file>
        <append>true</append>
        <immediateFlush>true</immediateFlush>
        <encoder class="PatternLayoutEncoder">
            <pattern>%-4relative [%thread] %-5level %logger{35} -%kvp- %msg%n</pattern>
        </encoder>
    </appender>
    <appender name="BUSINESS_EVENTS_FILE_APPENDER" class="FileAppender">
        <file>logs/business.log</file>
        <append>true</append>
        <immediateFlush>true</immediateFlush>
        <encoder class="PatternLayoutEncoder">
            <pattern>%-4relative [%thread] %-5level %logger{35} -%kvp- %msg%n</pattern>
        </encoder>
    </appender>
    <appender name="AI_FILE_APPENDER" class="FileAppender">
        <file>logs/ai.log</file>
        <append>true</append>
        <immediateFlush>true</immediateFlush>
        <encoder class="PatternLayoutEncoder">
            <pattern>%d %-4relative [%thread] %-5level %logger{35} -%kvp- %msg%n</pattern>
        </encoder>
    </appender>
    <appender name="AOP_FILE_APPENDER" class="FileAppender">
        <file>logs/aop.log</file>
        <append>true</append>
        <immediateFlush>true</immediateFlush>
        <encoder class="PatternLayoutEncoder">
            <pattern>%-4relative [%thread] %-5level %logger{35} -%kvp- %msg%n</pattern>
        </encoder>
    </appender>
    <springProperty name="host" source="spring.mail.host"/>
    <springProperty name="username" source="spring.mail.username"/>
    <springProperty name="tls" source="spring.mail.properties.mail.smtp.starttls.enable"/>
    <springProperty name="port" source="spring.mail.port"/>
    <springProperty name="password" source="spring.mail.password"/>
    <appender name="EMAIL" class="SMTPAppender">
        <smtpHost>${host}</smtpHost>
        <smtpPort>${port}</smtpPort>
        <username>${username}</username>
        <password>${password}</password>
        <STARTTLS>${tls}</STARTTLS>
        <to>${username}</to>
        <from>${username}</from>
        <subject>Notification: %logger{20} - %m</subject>
        <layout class="HTMLLayout"/>
        <cyclicBufferTracker class="CyclicBufferTracker">
            <bufferSize>1</bufferSize>
        </cyclicBufferTracker>
    </appender>
    <logger name="org.springframework.web" level="TRACE"/>
    <logger name="org.springframework.ai" level="TRACE">
        <appender-ref ref="AI_FILE_APPENDER"/>
    </logger>
    <logger name="org.springframework.test" level="TRACE"/>
    <logger name="org.springframework.security" level="TRACE"/>
    <logger name="com.example.rd.autocode.assessment.appliances.misc.infrastructure.security.AuthenticationEventListener" level="TRACE">
        <appender-ref ref="SECURITY_EVENTS_FILE_APPENDER"/>
    </logger>
    <logger name="com.example.rd.autocode.assessment.appliances.misc.infrastructure.logging.LoggingAspect" level="TRACE">
        <appender-ref ref="AOP_FILE_APPENDER"/>
    </logger>
    <logger name="com.example.rd.autocode.assessment.appliances.misc.infrastructure.logging.BusinessLogicLoggingListener" level="TRACE">
        <appender-ref ref="BUSINESS_EVENTS_FILE_APPENDER"/>
    </logger>
    <root level="INFO">
        <appender-ref ref="CONSOLE" />
        <appender-ref ref="EMAIL" />
    </root>
</configuration>